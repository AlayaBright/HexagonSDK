<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>HAP VTCM manager: HAP VTCM manager API.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HAP VTCM manager
   </div>
   <div id="projectbrief">HAP VTCM manager API</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__vtcmapi.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">HAP VTCM manager API.</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:HAP__vtcm__mgr_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="HAP__vtcm__mgr_8h.html">HAP_vtcm_mgr.h</a></td></tr>
<tr class="memdesc:HAP__vtcm__mgr_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">APIs used to allocate, release, and query Vector TCM (VTCM) memory. VTCM is a high-performance, tightly-coupled memory in the cDSP subsystem. It can used for Hexagon Vector eXtensions (HVX) scatter/gather instructions, the Hexagon Matrix eXtension (HMX) engine (available in some cDSPs starting with Lahaina), or as high-performance scratch memory for other HVX workloads. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga5391d497add853fc533bede0485b7152"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__vtcmapi.html#ga5391d497add853fc533bede0485b7152">HAP_request_VTCM</a> (unsigned int size, unsigned int single_page_flag)</td></tr>
<tr class="separator:ga5391d497add853fc533bede0485b7152"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1b5b97125be71b68808520be9dac56b2"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__vtcmapi.html#ga1b5b97125be71b68808520be9dac56b2">HAP_request_async_VTCM</a> (unsigned int size, unsigned int single_page_flag, unsigned int timeout_us)</td></tr>
<tr class="separator:ga1b5b97125be71b68808520be9dac56b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac6a977c7399db04fd26f04f34585b756"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__vtcmapi.html#gac6a977c7399db04fd26f04f34585b756">HAP_release_VTCM</a> (void *pVA)</td></tr>
<tr class="separator:gac6a977c7399db04fd26f04f34585b756"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab20ed74b8ad791a28aa4bd61698a8d7b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__vtcmapi.html#gab20ed74b8ad791a28aa4bd61698a8d7b">HAP_query_total_VTCM</a> (unsigned int *page_size, unsigned int *page_count)</td></tr>
<tr class="separator:gab20ed74b8ad791a28aa4bd61698a8d7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7db82a375461d2f364505f2f222c5d62"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__vtcmapi.html#ga7db82a375461d2f364505f2f222c5d62">HAP_query_avail_VTCM</a> (unsigned int *avail_block_size, unsigned int *max_page_size, unsigned int *num_pages)</td></tr>
<tr class="separator:ga7db82a375461d2f364505f2f222c5d62"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This section describes the HAP VTCM manager API to allocate and release VTCM. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga7db82a375461d2f364505f2f222c5d62"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HAP_query_avail_VTCM </td>
          <td>(</td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>avail_block_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>max_page_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>num_pages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>API to query VTCM allocation status.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">avail_block_size</td><td>Pointer to an <code>unsigned</code> <code>int</code> variable. If this parameter is non-zero on success, the memory location contains the maximum contiguous memory chunk (in bytes) available in VTCM. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">max_page_size</td><td>Pointer to an <code>unsigned</code> <code>int</code> variable. If this parameter is non-zero, the memory location contains the maximum possible page size allocation (in bytes) in the available portion of VTCM. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">num_pages</td><td>Pointer to an <code>unsigned</code> <code>int</code> variable. If this parameter is non-zero on success, the memory location contains the value of <code>max_page_size</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>int</code> 0 on success. <br />
Non-zero on failure.</dd></dl>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;unsigned int avail_block_size, max_page_size, num_pages;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;if (0 == HAP_query_avail_VTCM(&amp;avail_block_size, &amp;max_page_size, &amp;num_pages))</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    // Query successful.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    // Use avail_block_size, max_page_size, num_pages</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;}</div></div><!-- fragment --> </dd></dl>

</div>
</div>
<a class="anchor" id="gab20ed74b8ad791a28aa4bd61698a8d7b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HAP_query_total_VTCM </td>
          <td>(</td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>page_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>page_count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Query for the VTCM size defined on target.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">page_size</td><td>Pointer to an <code>unsigned</code> <code>int</code> variable. If this parameter is non-zero on success, the memory location contains the maximum possible page size allocation (in bytes) in VTCM. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">page_count</td><td>Pointer to an <code>unsigned</code> <code>int</code> variable. If <code>page_size</code> is non-zero on success, the memory location contains the number of <code>page_size</code> blocks in VTCM.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>int</code> 0 on success. <br />
Non-zero on failure.</dd></dl>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;unsigned int page_size, page_count;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;if (0 == HAP_query_total_VTCM(&amp;page_size, &amp;page_count))</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    // Query successful.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    // For SM8150 cDSP:</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    //      page_size will be 256 * 1024.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    //      page_count will be 1.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    // VTCM memory defined for this chipset (256 KB)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    unsigned int total_vtcm = page_size * page_count;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;}</div></div><!-- fragment --> </dd></dl>

</div>
</div>
<a class="anchor" id="gac6a977c7399db04fd26f04f34585b756"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HAP_release_VTCM </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pVA</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Release a successful request for VTCM memory by providing the pointer to the previously allocated VTCM block.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pVA</td><td>Pointer returned by a successful VTCM request call.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>int</code> 0 on success. <br />
Non-zero on failure. </dd></dl>

</div>
</div>
<a class="anchor" id="ga1b5b97125be71b68808520be9dac56b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * HAP_request_async_VTCM </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>single_page_flag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>timeout_us</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Request VTCM memory of a specified size and single page requirement with a timeout option.</p>
<p>This API can be used to wait for the provided timeout. The calling thread is suspended until the requested VTCM memory is available or until the timeout, whichever happens first.</p>
<p><b>NOTE:</b> A deadlock might occur when calling this API if the same thread holds a part of, or the entire VTCM memory prior to this call. This API is <em>not</em> supported from secure and CPZ PDs.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Size of the request in bytes. <br />
 If (<code>single_page_flag</code> == 0), the size is aligned to 4 KB. <br />
 If (<code>single_page_flag</code> == 1), the size is aligned to the closest possible page size,: 4 KB, 16 KB, 64 KB, 256 KB, 1 MB, 4 MB, 16 MB </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">single_page_flag</td><td>Single page requirement for this allocation: 1 for single page requests, 0 otherwise. Single page requests are mandatory for scatter/gather operations because the operations must be contained within a single page of memory. (The memory region used by scatter/gather instructions must reside in VTCM and cannot cross a page boundary). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeout_us</td><td>Timeout in microseconds. If the request is readily available, return success with a void pointer. If the request cannot be served, wait for the available VTCM memory until the timeout, or return failure on the timeout. This value must be greater than 200 for the timeout implementation to work; otherwise, it is treated like <a class="el" href="group__vtcmapi.html#ga5391d497add853fc533bede0485b7152">HAP_request_VTCM()</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>void*</code> pointer to the allocated memory region on success. <br />
0 on failure.</dd></dl>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// Request for a single page of 256 * 1024  bytes with</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;// timeout set to 5 milliseconds</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;void *pVTCM = HAP_request_async_VTCM(256 * 1024, 1, 5000);</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;if (0 != pVTCM)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    // Allocation is successful. Try a release</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    int result = HAP_release_VTCM(pVTCM);</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    if (0 == result)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    {</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        //Release successful</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    }</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;}</div></div><!-- fragment --> </dd></dl>

</div>
</div>
<a class="anchor" id="ga5391d497add853fc533bede0485b7152"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* HAP_request_VTCM </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>single_page_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Request VTCM memory of a specified size and single page requirement.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Size of the request in bytes. <br />
 If (<code>single_page_flag</code> == 0), the size is aligned to 4 KB. <br />
 If (<code>single_page_flag</code> == 1), the size is aligned to the closest possible page size: 4 KB, 16 KB, 64 KB, 256 KB, 1 MB, 4 MB, 16 MB. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">single_page_flag</td><td>Single page requirement for this allocation: 1 for single page requests, 0 otherwise. Single page requests are mandatory for scatter/gather operations because the operations must be contained within a single page of memory. (The memory region used by scatter/gather HVX instructions must reside in VTCM and cannot cross a page boundary).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>void*</code> pointer to the allocated memory region on success. <br />
0 on failure.</dd></dl>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; // Request for a single page of 4000 bytes</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;void *pVTCM = HAP_request_VTCM(4000, 1);</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;if (0 != pVTCM)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    // Allocation is successful. Try a release</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    int result = HAP_release_VTCM(pVTCM);</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    if (0 == result)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    {</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        //Release successful</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    }</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;}</div></div><!-- fragment --> </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright Â© 2020 Qualcomm Technologies Inc. All rights reserved.  Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
