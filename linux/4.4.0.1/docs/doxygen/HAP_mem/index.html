<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>HAPMEM: HAP_mem APIs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HAPMEM
   </div>
   <div id="projectbrief">HAP Memory Allocator</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">HAP_mem APIs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview</h2>
<p>The HAP_mem APIs provide functionality available from the DSP to</p>
<ul>
<li>allocate and free memory - <a class="el" href="HAP__mem_8h.html#a95df9fa3fb6a9658a5dbd61ecbe5f6c2">HAP_malloc()</a> and <a class="el" href="HAP__mem_8h.html#a6cbf154c1a894566432af06b420ab493">HAP_free()</a></li>
<li>map and unmap ION buffers allocated on the application processor and passed to the DSP using file descriptors - <a class="el" href="HAP__mem_8h.html#a7f0db933920418adb9d881a93ec68ead">HAP_mmap()</a> and <a class="el" href="HAP__mem_8h.html#a8be32dca351de1bd0b495aae1bbae812">HAP_munmap()</a></li>
<li>get heap statistics and set properties - <a class="el" href="HAP__mem_8h.html#a73a44a4e95750c7c7eb702ce43843f59">HAP_mem_get_stats()</a>, <a class="el" href="HAP__mem_8h.html#a6b3e5ea727196136d09d99970b1c4393">HAP_mem_set_grow_size()</a>, <a class="el" href="HAP__mem_8h.html#a151e061f8df8eb848ee3b1c7c67c33c1">HAP_mmap_get()</a>, <a class="el" href="HAP__mem_8h.html#a769902041dcd9709c94d32c4cdcd1f1d">HAP_mem_set_heap_thresholds()</a> and <a class="el" href="HAP__mem_8h.html#a189c5db0e73ceee1b3ab6059be22d76e">HAP_mmap_put()</a></li>
</ul>
<h2>Memory mapping</h2>
<p>A common usage scenario for using the mapping functionality consists of the application processor allocating ION memory and passing the file descriptor to the DSP. The DSP will then use the HAP_mem APIs to map the buffer onto the DSP and obtain a memory pointer. The mapping will remain valid until the buffer is being unmapped. This approach allows to maintain a mapping across multiple FastRPC calls.</p>
<h2>Memory allocation</h2>
<p>HAP_malloc and HAP_free are simple wrappers around the DSP malloc and free functions. If a user memory allocation request cannot be fulfilled with the existing DSP heap, the FastRPC runtime will attempt to grow the DSP heap by reserving additional memory from the HLOS.</p>
<p>The HAP_set_grow_size API can be called to configure the minimum and maximum size that should be added to the DSP heap when one of these growth events occurs. If many growth events are anticipated, it may be appropriate to set a larger growth rate to reduce the number of growth events. However, increasing the heap more than necessary will impact HLOS performance. Therefore, care must be taken in finding the appropriate growth rate for a given application.</p>
<p>Here is how the min and max values set by the HAP_set_grow_size control the growth of the heap: </p><pre class="fragment">min_grow_bytes = MIN(max,MAX(min,min_grow_bytes));

// The value will be aligned to the next 1MB boundary.

actual_grow_bytes = min_grow_bytes + request_size
actual_grow_bytes = ALIGN(actual_grow_bytes,0x100000)
</pre><h2>Memory statistics</h2>
<p>HAP_mem_get_stats is useful when called at the beginning and end of an application to check for any memory leaks. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright Â© 2020 Qualcomm Technologies Inc. All rights reserved.  Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
