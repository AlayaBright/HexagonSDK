<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>QHL: QHDSP IIR routines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QHL
   </div>
   <div id="projectbrief">Qualcomm Hexagon Libraries</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__qhdsp__iir__routines.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">QHDSP IIR routines<div class="ingroups"><a class="el" href="group__qhdsp__library.html">QHDSP library</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga77c50989f8a389e5ac6ba11ead511e27"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__qhdsp__iir__routines.html#ga77c50989f8a389e5ac6ba11ead511e27">qhdsp_iir_af</a> (const float *in_samples, const float *coefs, float *states, uint32_t num_biquads, uint32_t length, float *out_samples)</td></tr>
<tr class="memdesc:ga77c50989f8a389e5ac6ba11ead511e27"><td class="mdescLeft">&#160;</td><td class="mdescRight">IIR (cascaded biquad) filtering on a bulk of data - float point.  <a href="#ga77c50989f8a389e5ac6ba11ead511e27">More...</a><br /></td></tr>
<tr class="separator:ga77c50989f8a389e5ac6ba11ead511e27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga26c84530851ed1cf030eaa7f9f0b47d9"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__qhdsp__iir__routines.html#ga26c84530851ed1cf030eaa7f9f0b47d9">qhdsp_iir_ah</a> (const int16_t *in_samples, const int16_t *coefs, int64_t *states, uint32_t num_biquads, uint32_t length, int16_t *out_samples)</td></tr>
<tr class="memdesc:ga26c84530851ed1cf030eaa7f9f0b47d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">IIR (cascaded biquad) filtering on a bulk of data - 16-bit fixed point.  <a href="#ga26c84530851ed1cf030eaa7f9f0b47d9">More...</a><br /></td></tr>
<tr class="separator:ga26c84530851ed1cf030eaa7f9f0b47d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>//qhdsp_fir_routines </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga77c50989f8a389e5ac6ba11ead511e27"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t qhdsp_iir_af </td>
          <td>(</td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>in_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>coefs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>states</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>num_biquads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>out_samples</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>IIR (cascaded biquad) filtering on a bulk of data - float point. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">in_samples</td><td>input samples in time domain </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coefs</td><td>IIR filter coefficients arranged as b0, b1, a1, b2, a2 </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">states</td><td>pointer to filter states buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_biquads</td><td>number of consecutive IIR filter calls (with different coeffs) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>length of input/output data (number of samples) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_samples</td><td>output buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>States buffer should be aligned to 8 bytes </dd></dl>

</div>
</div>
<a class="anchor" id="ga26c84530851ed1cf030eaa7f9f0b47d9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t qhdsp_iir_ah </td>
          <td>(</td>
          <td class="paramtype">const int16_t *&#160;</td>
          <td class="paramname"><em>in_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int16_t *&#160;</td>
          <td class="paramname"><em>coefs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t *&#160;</td>
          <td class="paramname"><em>states</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>num_biquads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t *&#160;</td>
          <td class="paramname"><em>out_samples</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>IIR (cascaded biquad) filtering on a bulk of data - 16-bit fixed point. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">in_samples</td><td>input samples in time domain &lt;Q15&gt; </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coefs</td><td>IIR filter coefficients - arranged as b0, b1, a1, b2, a2 &lt;Q15&gt; and shift_amt &lt;int16&gt; </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">states</td><td>pointer to filter states buffer &lt;Q47&gt; </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_biquads</td><td>number of consecutive IIR filter calls (with different coeffs) - valid range 1-5 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>length of input/output data (number of samples) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_samples</td><td>output buffer &lt;Q15&gt; </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><pre class="fragment">                 Cascade of biquads, i.e. transfer function of:

                            b0 + b1*z^-1 + b2*z^-2
                    H(z) = -----------------------
                            a0 + a1*z^-1 + a2*z^-2

                 for each biquad in the filter. This implementation uses 5 instead
                 of 6 coefficients (all coefficients divided with a0 coefficient).
                 Also, a1 and a2 coeffs are stored with - sign and divided by 2.0,
                 so transfer function looks like this:

                            (b0/a0) +        (b1/a0)*z^-1 +        (b2/a0)*z^-2
                    H(z) = -----------------------------------------------------
                               1    + 2*(-a1/(2*a0))*z^-1 + 2*(-a2/(2*a0))*z^-2

                 If any of b0/a0, b1/a0 or b2/a0 coefficients are greater than 1.0 (abs value),
                 all three coefficients are divided with next larger power of 2.
                 Additionally, at the end of coefficients buffer, shift amount is
                 stored to compensate division of these three coefficients. If these
                 were not larger than 1.0, shift amount should be set to 0. Shift amount
                 is always &gt;=0.
                 Transfer function if any of b0/a0, b1/a0 or b2/a0 coefficients are greater than
                 1.0 (abs value):

                                        (b0/a0)/2^shift + (b1/a0)/2^shift*z^-1 + (b2/a0)/2^shift*z^-2
                    H(z) = (2^shift) * ----------------------------------------------------------------
                                         1              + 2*(-a1/(2*a0))*z^-1  + 2*(-a2/(2*a0))*z^-2


                 Coefficients are stored in following order:
                     b0/a0 \&lt;Q15\&gt;, b1/a0 \&lt;Q15\&gt;, -a1/(2*a0) \&lt;Q15\&gt;
                     b2/a0 \&lt;Q15\&gt;, -a2/(2*a0) \&lt;Q15\&gt;, shift_amount \&lt;int16\&gt;

                 Example 1:

                     Lowpass filter @2kHz, sample rate 48kHz, Q=0.707

                     b0/a0 = 0.01440110
                     b1/a0 = 0.02880221
                     b2/a0 = 0.01440110
                     a1/a0 = -1.63295501
                     a2/a0 = 0.69055942

                     Coeffs:
                         0x01d7,    // b0/a0 = 0.01440110
                         0x03af,    // b1/a0 = 0.02880221
                         0x6882,    // -(a1/(2*a0)) = 0.816477505
                         0x01d7,    // b2/a0 = 0.01440110
                         0xd3ce,    // -(a2/(2*a0)) = -0.34527971
                         0x0000     // shift amount

                 Example 2:

                     Lowshelf filter @2kHz, sample rate 48kHz, Q=0.707

                     b0/a0 = 1.01062062
                     b1/a0 = -1.63980490
                     b2/a0 = 0.69052203
                     a1/a0 = -1.64314011
                     a2/a0 = 0.69780744

                     max(abs(b0/a0), abs(b1/a0), abs(b2/a0)) = 1.63980490
                     all three "b" coefficients are divided by div=2.0
                     shift amount is log2(div) = 1

                     Coeffs:
                         0x40ae,    // b0/(2*a0) = 0.50531031
                         0x970e,    // b1/(2*a0) = -0.81990245
                         0x6929,    // -(a1/2*a0) = 0.821570055
                         0x2c31,    // b2/(2*a0) = 0.345261015
                         0xd358,    // -(a2/2*a0) = -0.34890372
                         0x0001     // shift amount
</pre> </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright © 2020 Qualcomm Technologies Inc. All rights reserved.  Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
