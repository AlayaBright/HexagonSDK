/**=============================================================================
@file
    test_copysign_af.c

@brief
    Accuracy test for qhmath_copysign_af function.

Copyright (c) 2019 Qualcomm Technologies Incorporated.
All Rights Reserved. Qualcomm Proprietary and Confidential.
=============================================================================**/

#include <stdio.h>
#include <string.h>
#include <stdbool.h>

#include "qhmath.h"

#define TEST_DATA_CNT    1024

static long test_passed = 0L;
static long fail_detected = 0L;

float_a8_t in_data[TEST_DATA_CNT] =
{
    -9.974975, 1.271706, -6.133915, 6.174810, 1.700186, -0.402539, -2.994171, 7.919248, 6.456801, 4.932096, -6.517838, 7.178869, 4.210028, 0.270699, -3.920103, -9.700308,
    -8.171941, -2.710959, -7.053743, -6.682028, 9.770501, -1.086154, -7.618336, -9.906613, -9.821772, -2.442396, 0.633259, 1.423688, 2.035279, 2.143315, -6.675314, 3.260903,
    -0.984222, -2.957549, -8.859218, 2.153691, 5.666372, 6.052126, 0.397656, -3.960997, 7.519456, 4.533525, 9.118015, 8.514359, 0.787072, -7.153233, -0.758385, -5.293435,
    7.244789, -5.807978, 5.593127, 6.873074, 9.935911, 9.993896, 2.229987, -2.151250, -4.675741, -4.054384, 6.802881, -9.525132, -2.482681, -8.147526, 3.544115, -8.875698,
    -9.824213, 8.375805, -4.482253, -4.542070, 1.758171, 3.823664, 6.752220, 4.529862, -0.301218, -5.892819, 4.874722, -0.630818, -0.840785, 8.983123, 4.888760, -7.834407,
    1.980956, -2.295297, 4.700156, 2.179327, 1.448103, -2.773217, -6.968902, -5.497909, -1.496933, 6.057619, 0.342112, 9.799799, 5.030976, -3.088778, -6.620380, 3.146153,
    -0.162053, -8.729209, 3.995178, 0.096133, -7.050081, 8.991668, -7.168493, 8.102359, 3.857845, -3.939024, -1.468856, -8.592486, 9.332255, 3.663747, -6.935331, 7.545091,
    6.433607, 1.640980, -6.172979, -6.442152, 6.343883, -0.494705, -6.888943, 0.078433, 4.640339, -1.888180, -4.408399, 1.374859, 3.644826, 5.117038, 4.438307, -0.494095,
    -7.539598, -2.643818, 6.693625, -9.298074, 0.340281, 3.259682, -1.475570, -7.906430, 8.986785, 8.427686, 0.990936, -3.080233, -0.565508, -2.500381, 6.939604, -3.662526,
    -0.878018, -4.562212, 9.659413, -4.044008, 4.783776, 1.345561, -6.080203, 5.226295, 6.788842, -2.046876, 0.018006, 7.803278, -9.450667, 9.892575, 1.451765, -8.989837,
    0.626545, -6.118656, 6.860866, 2.535173, 3.152257, -6.042970, 6.843165, -7.533494, -7.801447, 4.862514, -3.718680, 8.821375, -4.278390, -3.273721, -7.194739, 4.661702,
    6.692404, 4.159978, 2.004761, 4.944304, -4.945524, -7.110508, -9.967650, -8.779870, 6.124760, 7.052522, -5.788446, -7.687918, 1.064180, -9.714957, -7.724540, -0.909757,
    5.044404, 3.722953, 0.868862, -8.522294, -1.265603, -5.961180, 3.924375, -4.192938, -1.266213, -5.351421, 1.557360, 0.651570, 2.573626, -6.796167, 0.082705, 9.260842,
    3.915220, 8.496048, -6.201056, -3.281045, -6.432997, 9.903562, -0.851161, 9.960326, -8.049867, 2.503433, -8.112125, -1.245460, 8.630329, -9.031343, 7.892392, -4.199652,
    -5.453963, 5.381329, -1.785638, -5.960570, 2.561419, 2.082888, -0.967742, -0.672933, 1.956542, 2.694479, 7.095859, 6.575823, 2.495499, 4.418165, 1.315043, -2.497330,
    -6.314585, 4.758141, 1.102634, 8.101749, -5.142674, -6.221198, 2.094485, 3.970153, 1.692251, -2.974029, -0.110782, -8.392285, 4.814905, 2.240974, 2.407605, 3.822443,
    6.090579, -7.017731, 1.520737, 7.354656, 8.231147, 2.294076, 4.553667, -9.135716, 3.355510, 9.530625, -3.699759, 1.384014, -3.883480, -6.521500, -7.828913, 7.380902,
    7.024445, 4.886319, -6.902371, -3.461715, -8.413038, -8.467971, 2.819605, 6.400037, 0.901822, -1.034883, -1.820429, -4.025086, -0.688803, 0.024110, -6.946928, -3.539232,
    4.759972, -3.722343, 6.533708, 9.181494, 7.466964, 4.500565, -3.998840, 8.879971, -7.455367, -8.685263, 5.699332, 0.491653, 2.192755, 9.122288, -8.554643, 7.512741,
    3.077181, -3.557543, -7.903989, 0.101016, -5.458235, -4.194159, 8.399609, 1.023286, 3.256020, -7.709281, -0.149236, -2.417371, -0.063784, 5.867183, 0.185247, -2.352672,
    3.763237, 0.643025, 2.125614, -2.096316, -9.882199, 4.157537, -7.987609, 2.461318, 7.264931, -0.169988, 4.946745, -0.061953, -2.397839, 5.707266, 1.056246, -2.858058,
    9.114353, 2.616962, -6.468398, -2.515030, -7.367473, 4.865566, 9.034394, 2.239753, -9.443342, -3.403119, -8.881802, 2.784204, -7.367473, 6.941435, 7.286294, 1.937620,
    4.432814, 7.079379, -9.706412, -7.470626, 4.158147, 2.342906, -5.648671, -8.680990, -6.621601, 2.482070, -3.180334, -3.611866, -2.648701, 3.220008, 6.047853, 6.137577,
    0.530717, 2.222053, 5.963622, 8.012024, -7.103793, 2.603534, -1.951659, -4.925993, -7.269204, 7.103793, -8.676717, -1.443831, 1.467025, -3.954283, 0.961028, -5.488754,
    -3.773003, -7.787408, 6.160772, -7.305826, -4.315012, 5.762200, 7.904599, 5.792718, 4.875942, 2.304453, -2.777490, 7.133091, -5.430158, 7.271645, -5.411237, -5.009003,
    0.848109, 9.696646, -8.923917, -8.371532, 0.493484, -1.463973, -8.106632, -4.824061, 7.830744, -5.344707, -7.069002, -7.498093, 8.632771, -8.397778, -9.058199, -8.825648,
    -3.271889, 8.294015, -2.027955, -1.344340, 8.923307, 6.743675, 0.684530, 6.841945, 3.870663, -2.046266, -4.816736, -9.913327, 0.511795, 9.096042, -2.026124, -5.178076,
    1.711173, -4.897305, 3.680227, 8.905606, -1.290017, 7.804498, -9.856563, 8.819544, 2.031007, 5.723136, 1.533555, -7.151402, -5.553453, -2.339854, -9.914548, -1.641591,
    -8.355052, 3.198645, 7.101962, -8.702963, 6.221198, 3.241371, 3.829768, 6.053957, 0.602741, 3.712577, -7.144688, 3.790094, 4.557939, 5.554674, -9.378643, 7.373577,
    2.890408, 4.131291, -8.290963, 1.039766, 8.958098, -8.824427, -4.500565, -7.096469, 9.635609, 2.399670, -4.155095, 8.449660, -2.649312, 3.890805, -5.627308, -6.881619,
    -5.189062, 0.428785, 8.045595, -7.871639, 8.052919, -1.165502, -8.397778, 5.641957, -6.564226, 9.487899, 5.517441, 7.407758, -5.787225, -0.867641, -9.924924, 5.012665,
    -7.719047, -1.905881, -3.777276, 9.852290, -9.228492, -4.958342, -6.214484, -5.046236, -6.929838, 2.406384, 7.707450, 8.781701, -6.086917, 5.593127, 2.911161, 3.135166,
    8.182928, -0.890835, 8.425855, 3.283486, -6.984771, 2.726829, 1.390728, -1.559191, 8.860439, 0.811487, 1.571398, 0.729087, -4.894253, -2.060915, -2.994781, -9.267556,
    5.905026, -6.069826, -8.594317, -2.211676, 1.814936, -8.581500, -6.046632, -6.882229, 2.886746, -0.913419, 2.085940, 3.946959, -1.174047, 3.689383, -2.069460, 6.714377,
    1.844234, -6.008179, 8.989227, 7.520066, -2.165899, 9.749138, -6.293832, 7.914365, 1.488998, -1.158788, 2.546770, 4.170354, -9.007538, -4.288766, -4.795984, -1.847285,
    7.906430, 4.203925, 4.568926, 7.921079, -2.128666, -2.051759, 8.077334, -3.827937, -2.237922, 1.411481, -2.928861, 4.673910, 4.907071, 4.727622, 4.788659, -7.213660,
    -5.996582, -4.548173, 3.608814, 8.222602, -2.643208, 0.353099, -7.812433, 8.148747, -5.938597, 0.359203, 3.096713, -1.229591, 3.752861, -8.191473, -8.408765, -8.484451,
    -9.443953, -2.898343, -3.855403, 3.945738, -7.146519, -2.103030, -8.643147, 3.514817, 4.498733, -6.025880, 3.880428, 2.314219, 3.097934, 0.879849, -8.033998, 0.907315,
    -9.007538, 9.491562, -0.719321, 9.399396, 4.557329, 0.619221, 3.598437, 3.856014, -2.557756, -2.227546, -9.000824, 6.195563, -6.608783, -8.783532, -3.788873, 5.689566,
    -5.750603, -3.561815, -0.306711, -9.816889, -1.202734, 0.157170, 2.118900, 5.170751, -1.978515, -3.003937, 6.852931, 8.846400, 2.466201, 9.945677, -8.930631, 1.257057,
    7.271035, -2.264779, -3.871883, -4.315622, -9.465926, 2.251350, -2.176275, -9.627674, -9.379254, -0.885952, 7.158727, 8.735313, -1.962035, 4.545732, 2.231819, 6.167486,
    7.508469, 1.651967, 1.900388, -8.419752, 5.863521, -0.755943, 1.812494, 1.788690, 1.384014, 6.321299, 3.455000, -3.128452, -9.795526, -4.653768, -3.168737, -5.358135,
    5.420392, -2.565081, 7.397382, -7.662893, 4.511551, 2.578509, 7.878964, -6.339610, 0.711386, 8.040101, 5.601672, 9.304178, -6.052736, 8.030946, 5.948363, 9.067965,
    6.976226, 7.806940, 2.574236, -6.290780, 2.338633, -4.700156, -4.987030, 4.644002, 5.762200, -6.581317, 4.277779, -0.381176, -8.370312, 6.130863, 7.106845, -7.507248,
    -3.850520, 1.466414, -0.540483, 5.240944, -6.162603, 4.555498, 9.900510, -9.692984, 2.952666, 3.832820, -6.517228, -8.557695, -4.500565, 3.532517, 6.778466, 1.133152,
    -2.575457, 5.590075, -5.349590, 2.764672, -5.366680, -5.908078, 9.420759, -4.365062, -9.542222, 5.384381, -6.963408, -9.060640, -9.815058, -3.028352, 2.877590, -3.135166,
    -1.708731, -1.669668, -8.186590, 0.903653, 3.985412, -3.240150, 3.150426, 7.524949, 0.709555, 1.400494, -8.920255, -0.684530, -4.800256, -1.463973, 7.266762, -0.268258,
    -8.251289, 1.316263, 4.188055, 5.569323, 7.284463, 7.011017, -4.139836, 7.287515, 2.898343, 4.936979, 6.572771, 5.312357, 7.438276, 8.166448, 8.250679, 0.439161,
    -1.196631, -7.847224, -2.919706, 6.461074, -1.445662, -6.603290, -9.982910, 3.149205, 5.471053, -8.725547, -8.203681, -2.286752, 3.677786, 6.152226, -6.918241, -7.142857,
    -9.030732, -3.077181, -9.628895, 9.568468, 2.952666, -8.926969, 8.283029, 2.749413, -1.365703, -9.578845, -5.148167, -2.161016, 3.080233, 5.637684, -9.543443, 6.520890,
    -7.231361, 2.685324, 1.008026, 9.669790, -0.731529, -5.704215, -3.986023, 5.643178, -3.149205, -0.387890, 2.160405, -7.949767, 9.688711, 5.116428, -6.982330, -0.871914,
    4.232612, 9.974975, 5.510117, 2.833033, 2.424085, 8.922086, 3.763237, -4.203925, 1.343120, -4.192328, 0.964690, 4.247261, -5.071261, 0.933561, -0.147404, 9.041108,
    3.396405, 5.303201, 2.467421, -1.084933, 5.975219, 4.910733, 9.778436, -5.907468, 2.589496, 8.196356, 1.825922, 8.367870, 0.110782, -0.212104, -1.005585, 7.786798,
    8.807947, -6.341441, -4.960784, -5.939817, 4.609821, 8.822596, 2.501602, -9.172948, 2.826930, -9.309671, 1.127049, 0.889615, -1.073336, -8.772546, 9.920652, -7.444990,
    2.018189, -8.992889, -6.544084, 3.204749, -3.351238, -3.680837, 3.071688, -1.789300, -1.449934, -5.567492, 3.570360, -6.671041, -0.049135, 0.152898, 6.054567, -1.298563,
    -9.909665, -3.210242, -2.482070, -7.428510, 6.546525, 4.665975, 7.822810, 2.866604, 3.011872, 0.289621, 4.679403, 4.743492, 9.141820, -0.683309, -2.734764, -7.756279,
    8.093204, 6.424451, -0.904263, -7.826472, 7.388836, 5.227515, -9.217505, -1.666616, 8.722495, -8.644978, -6.702780, -5.774407, -7.661672, 1.822260, -7.632984, 2.365490,
    1.601917, 3.805963, 4.631184, 8.312937, 3.394574, -4.029969, 6.177252, -2.436293, 9.949950, 5.450301, -5.911740, -6.588641, -2.234870, -6.375622, 1.619617, -6.087527,
    9.202857, -6.194952, -2.365490, -3.920103, -7.583544, -6.036866, -9.075289, 5.423444, 5.220801, 7.620777, -9.964599, -1.027558, -1.472518, 6.030763, -0.773034, -0.102847,
    4.987640, -5.229957, 1.188086, -8.145085, 8.440504, 7.876522, 7.140416, -8.807337, -0.182196, 2.640767, 4.944304, 5.121311, -4.885098, 8.198187, 5.839717, -6.007569,
    1.056856, -8.975188, 0.443434, 5.807367, 4.083071, -9.519028, 4.634846, 1.067232, 8.284249, 7.510910, 5.938597, -3.891415, -2.101199, -0.362255, -8.948332, 3.039338,
    -9.982910, 5.371563, 5.123753, -5.605335, -6.904813, -8.849452, 3.412275, -9.346294, -3.082675, 3.957335, 5.963012, -1.274758, 9.634388, 2.710959, -4.094058, -0.460524,
    7.487106, -8.414258, -7.980285, -7.135533, -7.139805, 8.359935, -3.825495, -2.523576, 6.276742, -9.067354, 6.284066, -5.200049, 7.957701, -4.869839, -4.612873, -5.839717,
    -5.412458, 6.923124, 7.496872, 7.753838, 6.895657, 2.185430, -9.182104, -6.529435, -6.324961, -2.881863, -1.014740, -6.298715, 7.889340, 2.460707, 0.926847, 8.233589,
};

float_a8_t ok_data[TEST_DATA_CNT];

float_a8_t out_data[TEST_DATA_CNT];

/** ok_copysign_af function generates valid data for comparing */
int32_t ok_copysign_af(float_a8_t *input, float_a8_t *output, int32_t size, float y)
{
    if (size <= 0)
        return -1;

    for (int i = 0; i < TEST_DATA_CNT; ++i)
    {
        float abs_data = in_data[i] < 0 ? -in_data[i] : in_data[i];

        ok_data[i] = y < 0 ? -abs_data : abs_data;
    }

    return 0;
}

int main(void)
{
    int r;
    bool test_ok = true;

    for (int test_sign = 0; test_sign < 2; test_sign++)
    {
        float variable_with_sign = test_sign ? -1.0 : 1.0;

        // prepare_ok_data
        r = ok_copysign_af(in_data, ok_data, TEST_DATA_CNT, variable_with_sign);

        if (r != 0)
        {
            printf("Error with input parameters\n");
        }

        for (int test_cnt = 1; test_cnt <= TEST_DATA_CNT; test_cnt++)
        {
            if (!test_ok)
            {
                // break;
            }

            // printf("Test qhmath_copysign_af function: data count= %d | "
            //        "use sign from= %f\n",
            //        test_cnt, variable_with_sign);

            memset(out_data, 0, sizeof(out_data));

            int r = qhmath_copysign_af(in_data, out_data, test_cnt,
                    variable_with_sign);

            test_passed++;

            if (r == 0)
            {
                for (int i = 0; i < test_cnt; i++)
                {
                    if (out_data[i] != ok_data[i])
                    {
                        printf("ERROR on member index= %d / "
                                "test count= %d| "
                                "got: %f > should be: %f\n", i, test_cnt, out_data[i],
                                ok_data[i]);
                        test_ok = false;
                        fail_detected++;
                    }
                }
            }
            else
            {
                puts("Error with input parameter!");
                test_ok = false;
                fail_detected++;
            }
        }
    }

    if (test_ok)
    {
        printf("Test for qhmath_modexp_ah function:\n");
        printf("PASSED (%d tests passed, %d failed)\n",test_passed,fail_detected);
    }
    else
    {
      printf("Test for qhmath_modexp_ah function:\n");
      printf("FAILED (%d tests passed, %d failed)\n",test_passed,fail_detected);
    }

    return 0;
}
